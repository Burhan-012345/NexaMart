{% extends "main/base.html" %} {% block title %}Profile - {{
current_user.full_name or 'User' }}{% endblock %} {% block content %}
<div class="container py-5">
  <div class="row">
    <!-- Sidebar -->
    <div class="col-lg-3 mb-4">
      <div class="card border-0 shadow-sm">
        <div class="card-body text-center p-4">
          <div class="profile-avatar mb-3">
            {% if current_user.profile_image %}
            <img
              src="{{ current_user.profile_image }}"
              alt="Profile"
              class="rounded-circle"
              width="100"
              height="100"
              style="object-fit: cover"
            />
            {% else %}
            <div
              class="rounded-circle bg-navy text-yellow d-flex align-items-center justify-content-center mx-auto"
              style="width: 100px; height: 100px"
            >
              <i class="fas fa-user fa-3x"></i>
            </div>
            {% endif %}
          </div>
          <h5 class="text-navy mb-1">{{ current_user.full_name or 'User' }}</h5>
          <p class="text-muted small mb-3">{{ current_user.email }}</p>

          <!-- Reward Points -->
          <div class="reward-badge mb-3">
            <span class="badge bg-yellow text-navy px-3 py-2">
              <i class="fas fa-star me-1"></i>
              {{ current_user.reward_points or 0 }} Points
            </span>
          </div>

          <!-- Quick Stats -->
          <div class="quick-stats border-top pt-3">
            <div class="row text-center">
              <div class="col-4">
                <h6 class="text-navy mb-1">
                  {{ current_user.get_cart_count() }}
                </h6>
                <small class="text-muted">Cart</small>
              </div>
              <div class="col-4">
                <h6 class="text-navy mb-1">{{ current_user.orders|length }}</h6>
                <small class="text-muted">Orders</small>
              </div>
              <div class="col-4">
                <h6 class="text-navy mb-1">
                  {{ current_user.get_wishlist_count() }}
                </h6>
                <small class="text-muted">Wishlist</small>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Quick Actions -->
      <div class="card border-0 shadow-sm mt-4">
        <div class="card-header bg-light-navy">
          <h6 class="mb-0 text-navy">
            <i class="fas fa-bolt me-2 text-yellow"></i>Quick Actions
          </h6>
        </div>
        <div class="card-body p-3">
          <div class="d-grid gap-2">
            <a
              href="{{ url_for('cart') }}"
              class="btn btn-outline-navy btn-sm text-start"
            >
              <i class="fas fa-shopping-cart me-2"></i>View Cart
            </a>
            <a
              href="{{ url_for('orders') }}"
              class="btn btn-outline-navy btn-sm text-start"
            >
              <i class="fas fa-shopping-bag me-2"></i>My Orders
            </a>
            <a
              href="{{ url_for('track_order') }}"
              class="btn btn-outline-navy btn-sm text-start"
            >
              <i class="fas fa-truck me-2"></i>Track Order
            </a>
            <button
              class="btn btn-outline-navy btn-sm text-start"
              onclick="showWishlistTab()"
            >
              <i class="fas fa-heart me-2"></i>My Wishlist
            </button>
            <a
              href="{{ url_for('categories') }}"
              class="btn btn-yellow btn-sm text-start"
            >
              <i class="fas fa-shopping-bag me-2"></i>Continue Shopping
            </a>
          </div>
        </div>
      </div>

      <!-- Reward Progress -->
      <div class="card border-0 shadow-sm mt-4">
        <div class="card-header bg-light-navy">
          <h6 class="mb-0 text-navy">
            <i class="fas fa-trophy me-2 text-yellow"></i>Reward Progress
          </h6>
        </div>
        <div class="card-body">
          <div class="text-center mb-3">
            <div
              class="reward-progress mx-auto position-relative"
              style="width: 80px; height: 80px"
            >
              <div
                class="progress-circle"
                data-percentage="{{ ((current_user.reward_points or 0) / 500 * 100)|round|int }}"
              >
                <span class="progress-value"
                  >{{ ((current_user.reward_points or 0) / 500 * 100)|round|int
                  }}%</span
                >
              </div>
            </div>
          </div>
          <p class="small text-muted text-center mb-2">
            {{ current_user.reward_points or 0 }} of 500 points
          </p>
          <div class="progress mb-2" style="height: 6px">
            {% set progress = ((current_user.reward_points or 0) / 500 * 100) %}
            <div
              class="progress-bar bg-yellow"
              style="width: {{ progress }}%"
            ></div>
          </div>
          <small class="text-muted d-block text-center"
            >Earn 500 points for Gold tier</small
          >
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <div class="col-lg-9">
      <!-- Tab Navigation -->
      <div class="card border-0 shadow-sm mb-4">
        <div class="card-header bg-light-navy p-0">
          <ul
            class="nav nav-pills nav-fill p-3"
            id="profileTabs"
            role="tablist"
          >
            <li class="nav-item" role="presentation">
              <button
                class="nav-link active"
                id="personal-tab"
                data-bs-toggle="tab"
                data-bs-target="#personal"
                type="button"
                role="tab"
              >
                <i class="fas fa-user-edit me-2"></i>Personal Info
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button
                class="nav-link"
                id="addresses-tab"
                data-bs-toggle="tab"
                data-bs-target="#addresses"
                type="button"
                role="tab"
              >
                <i class="fas fa-map-marker-alt me-2"></i>Addresses
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button
                class="nav-link"
                id="wishlist-tab"
                data-bs-toggle="tab"
                data-bs-target="#wishlist"
                type="button"
                role="tab"
              >
                <i class="fas fa-heart me-2"></i>Wishlist
                <span class="badge bg-yellow text-navy ms-1"
                  >{{ current_user.get_wishlist_count() }}</span
                >
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button
                class="nav-link"
                id="security-tab"
                data-bs-toggle="tab"
                data-bs-target="#security"
                type="button"
                role="tab"
              >
                <i class="fas fa-shield-alt me-2"></i>Security
              </button>
            </li>
          </ul>
        </div>

        <div class="card-body p-4">
          <div class="tab-content" id="profileTabsContent">
            <!-- Personal Information Tab -->
            <div
              class="tab-pane fade show active"
              id="personal"
              role="tabpanel"
            >
              <form method="POST" action="{{ url_for('update_profile') }}">
                <div class="row">
                  <div class="col-md-6">
                    <div class="mb-3">
                      <label for="full_name" class="form-label text-navy"
                        >Full Name</label
                      >
                      <input
                        type="text"
                        class="form-control"
                        id="full_name"
                        name="full_name"
                        value="{{ current_user.full_name or '' }}"
                        placeholder="Enter your full name"
                      />
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="mb-3">
                      <label for="email" class="form-label text-navy"
                        >Email Address</label
                      >
                      <input
                        type="email"
                        class="form-control"
                        id="email"
                        value="{{ current_user.email }}"
                        readonly
                      />
                      <small class="form-text text-muted"
                        >Email cannot be changed</small
                      >
                    </div>
                  </div>
                </div>

                <div class="row">
                  <div class="col-md-6">
                    <div class="mb-3">
                      <label for="phone" class="form-label text-navy"
                        >Phone Number</label
                      >
                      <input
                        type="tel"
                        class="form-control"
                        id="phone"
                        value="{{ current_user.phone }}"
                        readonly
                      />
                      <small class="form-text text-muted"
                        >Phone cannot be changed</small
                      >
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="mb-3">
                      <label for="date_of_birth" class="form-label text-navy"
                        >Date of Birth</label
                      >
                      <input
                        type="date"
                        class="form-control"
                        id="date_of_birth"
                        name="date_of_birth"
                        value="{{ current_user.date_of_birth or '' }}"
                      />
                    </div>
                  </div>
                </div>

                <div class="mb-3">
                  <label class="form-label text-navy">Gender</label>
                  <div>
                    <div class="form-check form-check-inline">
                      <input class="form-check-input" type="radio" name="gender"
                      id="male" value="male" {{ 'checked' if current_user.gender
                      == 'male' }}>
                      <label class="form-check-label" for="male">Male</label>
                    </div>
                    <div class="form-check form-check-inline">
                      <input class="form-check-input" type="radio" name="gender"
                      id="female" value="female" {{ 'checked' if
                      current_user.gender == 'female' }}>
                      <label class="form-check-label" for="female"
                        >Female</label
                      >
                    </div>
                    <div class="form-check form-check-inline">
                      <input class="form-check-input" type="radio" name="gender"
                      id="other" value="other" {{ 'checked' if
                      current_user.gender == 'other' }}>
                      <label class="form-check-label" for="other">Other</label>
                    </div>
                  </div>
                </div>

                <div class="mb-3">
                  <label for="address" class="form-label text-navy"
                    >Address</label
                  >
                  <textarea
                    class="form-control"
                    id="address"
                    name="address"
                    rows="3"
                    placeholder="Enter your address"
                  >
{{ current_user.address or '' }}</textarea
                  >
                </div>

                <div class="row">
                  <div class="col-md-4">
                    <div class="mb-3">
                      <label for="city" class="form-label text-navy"
                        >City</label
                      >
                      <input
                        type="text"
                        class="form-control"
                        id="city"
                        name="city"
                        value="{{ current_user.city or '' }}"
                        placeholder="Enter city"
                      />
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="mb-3">
                      <label for="state" class="form-label text-navy"
                        >State</label
                      >
                      <input
                        type="text"
                        class="form-control"
                        id="state"
                        name="state"
                        value="{{ current_user.state or '' }}"
                        placeholder="Enter state"
                      />
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="mb-3">
                      <label for="pincode" class="form-label text-navy"
                        >Pincode</label
                      >
                      <input
                        type="text"
                        class="form-control"
                        id="pincode"
                        name="pincode"
                        value="{{ current_user.pincode or '' }}"
                        placeholder="Enter pincode"
                      />
                    </div>
                  </div>
                </div>

                <div class="mb-4">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox"
                    id="newsletter" name="newsletter" {{ 'checked' if
                    current_user.newsletter_subscribed }}>
                    <label class="form-check-label text-navy" for="newsletter">
                      Subscribe to newsletter
                    </label>
                  </div>
                  <div class="form-check mt-2">
                    <input class="form-check-input" type="checkbox"
                    id="marketing_emails" name="marketing_emails" {{ 'checked'
                    if current_user.marketing_emails }}>
                    <label
                      class="form-check-label text-navy"
                      for="marketing_emails"
                    >
                      Receive marketing emails
                    </label>
                  </div>
                </div>

                <div class="d-flex gap-2">
                  <button type="submit" class="btn btn-navy">
                    <i class="fas fa-save me-2"></i>Update Profile
                  </button>
                  <button type="reset" class="btn btn-outline-navy">
                    Reset
                  </button>
                </div>
              </form>
            </div>

            <!-- Addresses Tab -->
            <div class="tab-pane fade" id="addresses" role="tabpanel">
              <div
                class="d-flex justify-content-between align-items-center mb-4"
              >
                <h5 class="text-navy mb-0">Saved Addresses</h5>
                <button
                  class="btn btn-yellow btn-sm"
                  data-bs-toggle="modal"
                  data-bs-target="#addAddressModal"
                >
                  <i class="fas fa-plus me-2"></i>Add New Address
                </button>
              </div>

              {% if current_user.user_addresses %}
              <div class="row">
                {% for address in current_user.user_addresses %}
                <div class="col-md-6 mb-4">
                  <div
                    class="card address-card h-100 {{ 'border-navy border-2' if address.is_default }}"
                  >
                    <div class="card-body">
                      <div
                        class="d-flex justify-content-between align-items-start mb-3"
                      >
                        <h6 class="card-title text-navy mb-0">
                          {{ address.label }} {% if address.is_default %}
                          <span class="badge bg-yellow text-navy ms-2"
                            >Default</span
                          >
                          {% endif %}
                        </h6>
                        <div class="dropdown">
                          <button
                            class="btn btn-sm btn-outline-navy dropdown-toggle"
                            type="button"
                            data-bs-toggle="dropdown"
                            aria-expanded="false"
                          >
                            <i class="fas fa-ellipsis-v"></i>
                          </button>
                          <ul class="dropdown-menu">
                            <li>
                              <a
                                class="dropdown-item"
                                href="#"
                                onclick="editAddress({{ address.id }})"
                              >
                                <i class="fas fa-edit me-2"></i>Edit
                              </a>
                            </li>
                            {% if not address.is_default %}
                            <li>
                              <a
                                class="dropdown-item"
                                href="{{ url_for('set_default_address', address_id=address.id) }}"
                              >
                                <i class="fas fa-star me-2"></i>Set as Default
                              </a>
                            </li>
                            <li><hr class="dropdown-divider" /></li>
                            <li>
                              <a
                                class="dropdown-item text-danger"
                                href="#"
                                onclick="confirmDeleteAddress({{ address.id }})"
                              >
                                <i class="fas fa-trash me-2"></i>Delete
                              </a>
                            </li>
                            {% endif %}
                          </ul>
                        </div>
                      </div>
                      <p class="card-text mb-2">
                        <strong>{{ address.full_name }}</strong>
                      </p>
                      <p class="card-text mb-2 small">
                        {{ address.address_line1 }}
                      </p>
                      {% if address.address_line2 %}
                      <p class="card-text mb-2 small">
                        {{ address.address_line2 }}
                      </p>
                      {% endif %}
                      <p class="card-text mb-2 small">
                        {{ address.city }}, {{ address.state }} - {{
                        address.pincode }}
                      </p>
                      <p class="card-text mb-0 small text-muted">
                        <i class="fas fa-phone me-1"></i>{{ address.phone }}
                      </p>
                    </div>
                  </div>
                </div>
                {% endfor %}
              </div>
              {% else %}
              <div class="text-center py-5">
                <i class="fas fa-map-marker-alt fa-3x text-muted mb-3"></i>
                <h5 class="text-navy">No Addresses Saved</h5>
                <p class="text-muted">
                  Add your first address to make checkout faster.
                </p>
                <button
                  class="btn btn-navy"
                  data-bs-toggle="modal"
                  data-bs-target="#addAddressModal"
                >
                  <i class="fas fa-plus me-2"></i>Add Your First Address
                </button>
              </div>
              {% endif %}
            </div>

            <!-- Wishlist Tab -->
            <div class="tab-pane fade" id="wishlist" role="tabpanel">
              <div
                class="d-flex justify-content-between align-items-center mb-4"
              >
                <h5 class="text-navy mb-0">
                  My Wishlist
                  <span class="badge bg-yellow text-navy ms-2"
                    >{{ current_user.get_wishlist_count() }}</span
                  >
                </h5>
                {% if current_user.get_wishlist_count() > 0 %}
                <button
                  class="btn btn-outline-danger btn-sm"
                  onclick="confirmClearWishlist()"
                >
                  <i class="fas fa-trash me-2"></i>Clear All
                </button>
                {% endif %}
              </div>

              {% set wishlist_products = current_user.get_wishlist_products() %}
              {% if wishlist_products %}
              <div class="row">
                {% for product in wishlist_products %}
                <div class="col-xl-3 col-lg-4 col-md-6 mb-4">
                  <div class="card product-card h-100 border-0 shadow-sm">
                    <div class="position-relative">
                      <img
                        src="{{ product.image_url or '/static/images/placeholder.jpg' }}"
                        class="card-img-top"
                        alt="{{ product.name }}"
                        style="height: 200px; object-fit: cover"
                      />
                      <div
                        class="card-img-overlay d-flex justify-content-end align-items-start p-2"
                      >
                        <button
                          class="btn btn-sm btn-danger wishlist-btn"
                          onclick="removeFromWishlist({{ product.id }})"
                          title="Remove from Wishlist"
                        >
                          <i class="fas fa-heart"></i>
                        </button>
                      </div>
                      {% if product.discount_percentage > 0 %}
                      <span
                        class="badge bg-yellow text-navy position-absolute top-0 start-0 m-2"
                      >
                        {{ product.discount_percentage }}% OFF
                      </span>
                      {% endif %}
                    </div>
                    <div class="card-body d-flex flex-column">
                      <h6 class="card-title text-navy mb-2">
                        {{ product.name }}
                      </h6>
                      <div
                        class="d-flex justify-content-between align-items-center mb-2"
                      >
                        <div class="price">
                          <span class="h6 text-navy mb-0"
                            >₹{{ "%.2f"|format(product.current_price) }}</span
                          >
                          {% if product.discount_percentage > 0 %}
                          <small
                            class="text-muted text-decoration-line-through ms-1"
                          >
                            ₹{{ "%.2f"|format(product.price) }}
                          </small>
                          {% endif %}
                        </div>
                        <div class="rating small text-warning">
                          <i class="fas fa-star"></i>
                          <span class="text-muted"
                            >{{ "%.1f"|format(product.average_rating) }}</span
                          >
                        </div>
                      </div>
                      <div class="stock-status mb-3">
                        {% if product.is_in_stock() %}
                        <span class="badge bg-success">In Stock</span>
                        {% else %}
                        <span class="badge bg-danger">Out of Stock</span>
                        {% endif %}
                      </div>
                      <div class="mt-auto">
                        {% if product.is_in_stock() %}
                        <button
                          class="btn btn-navy btn-sm w-100"
                          onclick="addToCartFromWishlist({{ product.id }})"
                        >
                          <i class="fas fa-shopping-cart me-2"></i>Add to Cart
                        </button>
                        {% else %}
                        <button
                          class="btn btn-outline-secondary btn-sm w-100"
                          disabled
                        >
                          <i class="fas fa-times me-2"></i>Out of Stock
                        </button>
                        {% endif %}
                      </div>
                    </div>
                  </div>
                </div>
                {% endfor %}
              </div>
              {% else %}
              <div class="text-center py-5">
                <i class="fas fa-heart fa-3x text-muted mb-3"></i>
                <h5 class="text-navy">Your Wishlist is Empty</h5>
                <p class="text-muted">Save items you love for later.</p>
                <a href="{{ url_for('categories') }}" class="btn btn-navy">
                  <i class="fas fa-shopping-bag me-2"></i>Start Shopping
                </a>
              </div>
              {% endif %}
            </div>

            <!-- Security Tab -->
            <!-- Security Tab -->
            <div class="tab-pane fade" id="security" role="tabpanel">
              <div class="row">
                <div class="col-lg-8">
                  <h5 class="text-navy mb-4">Change Password</h5>
                  <form method="POST" action="{{ url_for('reset_password') }}">
                    <div class="mb-3">
                      <label for="current_password" class="form-label text-navy"
                        >Current Password</label
                      >
                      <input
                        type="password"
                        class="form-control"
                        id="current_password"
                        name="current_password"
                        required
                      />
                    </div>
                    <div class="mb-3">
                      <label for="new_password" class="form-label text-navy"
                        >New Password</label
                      >
                      <input
                        type="password"
                        class="form-control"
                        id="new_password"
                        name="new_password"
                        required
                      />
                    </div>
                    <div class="mb-4">
                      <label for="confirm_password" class="form-label text-navy"
                        >Confirm New Password</label
                      >
                      <input
                        type="password"
                        class="form-control"
                        id="confirm_password"
                        name="confirm_password"
                        required
                      />
                    </div>
                    <button type="submit" class="btn btn-navy">
                      <i class="fas fa-lock me-2"></i>Change Password
                    </button>
                  </form>

                  <hr class="my-5" />

                  <h5 class="text-navy mb-4">Two-Factor Authentication</h5>
                  <div class="alert alert-info">
                    <i class="fas fa-info-circle me-2"></i>
                    Enhance your account security by enabling two-factor
                    authentication.
                  </div>
                  <button class="btn btn-outline-navy" disabled>
                    <i class="fas fa-mobile-alt me-2"></i>Enable 2FA (Coming
                    Soon)
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Recent Orders Section -->
      <div class="card border-0 shadow-sm">
        <div
          class="card-header bg-light-navy d-flex justify-content-between align-items-center"
        >
          <h5 class="mb-0 text-navy">
            <i class="fas fa-clock me-2 text-yellow"></i>Recent Orders
          </h5>
          <a href="{{ url_for('orders') }}" class="btn btn-navy btn-sm">
            View All <i class="fas fa-arrow-right ms-1"></i>
          </a>
        </div>
        <div class="card-body">
          {% if orders %}
          <div class="table-responsive">
            <table class="table table-hover">
              <thead>
                <tr>
                  <th class="text-navy">Order ID</th>
                  <th class="text-navy">Date</th>
                  <th class="text-navy">Amount</th>
                  <th class="text-navy">Status</th>
                  <th class="text-navy">Action</th>
                </tr>
              </thead>
              <tbody>
                {% for order in orders[:5] %}
                <tr>
                  <td>
                    <strong class="text-navy">{{ order.order_id }}</strong>
                  </td>
                  <td>{{ order.created_at.strftime('%d %b %Y') }}</td>
                  <td>₹{{ "%.2f"|format(order.total_amount) }}</td>
                  <td>
                    <span class="badge {{ order.get_status_badge_class() }}">
                      {{ order.get_status_display() }}
                    </span>
                  </td>
                  <td>
                    <a
                      href="{{ url_for('order_details', order_id=order.id) }}"
                      class="btn btn-sm btn-outline-navy"
                    >
                      View Details
                    </a>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          {% else %}
          <div class="text-center py-4">
            <i class="fas fa-shopping-bag fa-3x text-muted mb-3"></i>
            <h5 class="text-navy">No Orders Yet</h5>
            <p class="text-muted">Start shopping to see your orders here.</p>
            <a href="{{ url_for('categories') }}" class="btn btn-navy">
              <i class="fas fa-shopping-bag me-2"></i>Start Shopping
            </a>
          </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Add Address Modal -->
<div
  class="modal fade"
  id="addAddressModal"
  tabindex="-1"
  aria-labelledby="addAddressModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header bg-navy text-white">
        <h5 class="modal-title" id="addAddressModalLabel">Add New Address</h5>
        <button
          type="button"
          class="btn-close btn-close-white"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <form method="POST" action="{{ url_for('manage_addresses') }}">
        <div class="modal-body">
          <div class="row">
            <div class="col-md-6">
              <div class="mb-3">
                <label for="label" class="form-label">Address Label</label>
                <select class="form-select" id="label" name="label" required>
                  <option value="">Select Label</option>
                  <option value="Home">Home</option>
                  <option value="Office">Office</option>
                  <option value="Other">Other</option>
                </select>
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <label for="full_name" class="form-label">Full Name</label>
                <input
                  type="text"
                  class="form-control"
                  id="full_name"
                  name="full_name"
                  value="{{ current_user.full_name or '' }}"
                  required
                />
              </div>
            </div>
          </div>
          <div class="mb-3">
            <label for="phone" class="form-label">Phone Number</label>
            <input
              type="tel"
              class="form-control"
              id="phone"
              name="phone"
              value="{{ current_user.phone or '' }}"
              required
            />
          </div>
          <div class="mb-3">
            <label for="address_line1" class="form-label">Address Line 1</label>
            <input
              type="text"
              class="form-control"
              id="address_line1"
              name="address_line1"
              placeholder="House/Flat No, Street Name"
              required
            />
          </div>
          <div class="mb-3">
            <label for="address_line2" class="form-label"
              >Address Line 2 (Optional)</label
            >
            <input
              type="text"
              class="form-control"
              id="address_line2"
              name="address_line2"
              placeholder="Area, Landmark"
            />
          </div>
          <div class="row">
            <div class="col-md-4">
              <div class="mb-3">
                <label for="city" class="form-label">City</label>
                <input
                  type="text"
                  class="form-control"
                  id="city"
                  name="city"
                  required
                />
              </div>
            </div>
            <div class="col-md-4">
              <div class="mb-3">
                <label for="state" class="form-label">State</label>
                <input
                  type="text"
                  class="form-control"
                  id="state"
                  name="state"
                  required
                />
              </div>
            </div>
            <div class="col-md-4">
              <div class="mb-3">
                <label for="pincode" class="form-label">Pincode</label>
                <input
                  type="text"
                  class="form-control"
                  id="pincode"
                  name="pincode"
                  pattern="[0-9]{6}"
                  maxlength="6"
                  required
                />
              </div>
            </div>
          </div>
          <div class="form-check mb-3">
            <input
              class="form-check-input"
              type="checkbox"
              id="is_default"
              name="is_default"
            />
            <label class="form-check-label" for="is_default">
              Set as default address
            </label>
          </div>
        </div>
        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-secondary"
            data-bs-dismiss="modal"
          >
            Cancel
          </button>
          <button type="submit" class="btn btn-navy">Save Address</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Edit Address Modal -->
<div
  class="modal fade"
  id="editAddressModal"
  tabindex="-1"
  aria-labelledby="editAddressModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header bg-navy text-white">
        <h5 class="modal-title" id="editAddressModalLabel">Edit Address</h5>
        <button
          type="button"
          class="btn-close btn-close-white"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <form id="editAddressForm" method="POST">
        <div class="modal-body">
          <input type="hidden" id="edit_address_id" name="address_id" />
          <div class="row">
            <div class="col-md-6">
              <div class="mb-3">
                <label for="edit_label" class="form-label">Address Label</label>
                <select
                  class="form-select"
                  id="edit_label"
                  name="label"
                  required
                >
                  <option value="">Select Label</option>
                  <option value="Home">Home</option>
                  <option value="Office">Office</option>
                  <option value="Other">Other</option>
                </select>
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <label for="edit_full_name" class="form-label">Full Name</label>
                <input
                  type="text"
                  class="form-control"
                  id="edit_full_name"
                  name="full_name"
                  required
                />
              </div>
            </div>
          </div>
          <div class="mb-3">
            <label for="edit_phone" class="form-label">Phone Number</label>
            <input
              type="tel"
              class="form-control"
              id="edit_phone"
              name="phone"
              required
            />
          </div>
          <div class="mb-3">
            <label for="edit_address_line1" class="form-label"
              >Address Line 1</label
            >
            <input
              type="text"
              class="form-control"
              id="edit_address_line1"
              name="address_line1"
              required
            />
          </div>
          <div class="mb-3">
            <label for="edit_address_line2" class="form-label"
              >Address Line 2 (Optional)</label
            >
            <input
              type="text"
              class="form-control"
              id="edit_address_line2"
              name="address_line2"
            />
          </div>
          <div class="row">
            <div class="col-md-4">
              <div class="mb-3">
                <label for="edit_city" class="form-label">City</label>
                <input
                  type="text"
                  class="form-control"
                  id="edit_city"
                  name="city"
                  required
                />
              </div>
            </div>
            <div class="col-md-4">
              <div class="mb-3">
                <label for="edit_state" class="form-label">State</label>
                <input
                  type="text"
                  class="form-control"
                  id="edit_state"
                  name="state"
                  required
                />
              </div>
            </div>
            <div class="col-md-4">
              <div class="mb-3">
                <label for="edit_pincode" class="form-label">Pincode</label>
                <input
                  type="text"
                  class="form-control"
                  id="edit_pincode"
                  name="pincode"
                  required
                />
              </div>
            </div>
          </div>
          <div class="form-check mb-3">
            <input
              class="form-check-input"
              type="checkbox"
              id="edit_is_default"
              name="is_default"
            />
            <label class="form-check-label" for="edit_is_default">
              Set as default address
            </label>
          </div>
        </div>
        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-secondary"
            data-bs-dismiss="modal"
          >
            Cancel
          </button>
          <button type="submit" class="btn btn-navy">Update Address</button>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %} {% block styles %}
<style>
  .profile-avatar {
    width: 100px;
    height: 100px;
    margin: 0 auto;
  }

  .reward-progress {
    position: relative;
  }

  .progress-circle {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    background: conic-gradient(#ffd700 var(--percentage), #e9ecef 0deg);
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .progress-value {
    font-size: 14px;
    font-weight: bold;
    color: #001f3f;
  }

  .address-card {
    transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
  }

  .address-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1) !important;
  }

  .product-card {
    transition: transform 0.2s ease-in-out;
  }

  .product-card:hover {
    transform: translateY(-5px);
  }

  .wishlist-btn {
    opacity: 0.9;
    transition: opacity 0.2s ease-in-out;
  }

  .wishlist-btn:hover {
    opacity: 1;
  }

  .nav-pills .nav-link {
    color: #001f3f;
    border-radius: 8px;
    margin: 0 2px;
    transition: all 0.3s ease;
  }

  .nav-pills .nav-link.active {
    background: linear-gradient(135deg, #001f3f, #003366);
    color: white;
    border: none;
  }

  .nav-pills .nav-link:hover:not(.active) {
    background-color: rgba(0, 31, 63, 0.1);
  }

  .bg-navy {
    background: linear-gradient(135deg, #001f3f, #003366) !important;
  }

  .text-navy {
    color: #001f3f !important;
  }

  .btn-navy {
    background: linear-gradient(135deg, #001f3f, #003366);
    border-color: #001f3f;
    color: white;
  }

  .btn-navy:hover {
    background: #001a35;
    border-color: #001a35;
    color: white;
  }

  .btn-outline-navy {
    border-color: #001f3f;
    color: #001f3f;
  }

  .btn-outline-navy:hover {
    background: #001f3f;
    border-color: #001f3f;
    color: white;
  }

  .bg-yellow {
    background: linear-gradient(135deg, #ffd700, #ffa500) !important;
  }

  .text-yellow {
    color: #ffd700 !important;
  }

  .btn-yellow {
    background: linear-gradient(135deg, #ffd700, #ffa500);
    border-color: #ffd700;
    color: #001f3f;
    font-weight: 600;
  }

  .btn-yellow:hover {
    background: #ffa500;
    border-color: #ffa500;
    color: #001f3f;
  }

  .bg-light-navy {
    background-color: rgba(0, 31, 63, 0.05) !important;
  }

  .border-navy {
    border-color: #001f3f !important;
  }

  .card {
    border-radius: 12px;
  }

  .table th {
    border-top: none;
    font-weight: 600;
  }

  .form-control:focus {
    border-color: #001f3f;
    box-shadow: 0 0 0 0.2rem rgba(0, 31, 63, 0.25);
  }

  .badge.bg-yellow {
    color: #001f3f !important;
  }

  .toast {
    border-radius: 8px;
  }
</style>
{% endblock %} {% block scripts %}
<script>
  function showWishlistTab() {
    const wishlistTab = document.getElementById("wishlist-tab");
    const tab = new bootstrap.Tab(wishlistTab);
    tab.show();
  }

  function removeFromWishlist(productId) {
    if (
      confirm("Are you sure you want to remove this item from your wishlist?")
    ) {
      fetch(`/api/wishlist/remove/${productId}`, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "X-Requested-With": "XMLHttpRequest",
        },
      })
        .then((response) => response.json())
        .then((data) => {
          if (data.success) {
            showToast("Item removed from wishlist", "success");
            setTimeout(() => location.reload(), 1000);
          } else {
            showToast(
              data.message || "Error removing item from wishlist",
              "error"
            );
          }
        })
        .catch((error) => {
          console.error("Error:", error);
          showToast("Error removing item from wishlist", "error");
        });
    }
  }

  function confirmClearWishlist() {
    if (
      confirm(
        "Are you sure you want to clear your entire wishlist? This action cannot be undone."
      )
    ) {
      fetch("/api/wishlist/clear", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "X-Requested-With": "XMLHttpRequest",
        },
      })
        .then((response) => response.json())
        .then((data) => {
          if (data.success) {
            showToast("Wishlist cleared successfully", "success");
            setTimeout(() => location.reload(), 1000);
          } else {
            showToast(data.message || "Error clearing wishlist", "error");
          }
        })
        .catch((error) => {
          console.error("Error:", error);
          showToast("Error clearing wishlist", "error");
        });
    }
  }

  function addToCartFromWishlist(productId) {
    fetch(`/add_to_cart/${productId}`, {
      method: "POST",
      headers: {
        "Content-Type": "application/x-www-form-urlencoded",
        "X-Requested-With": "XMLHttpRequest",
      },
      body: `quantity=1`,
    })
      .then((response) => response.json())
      .then((data) => {
        if (data.success) {
          showToast("Product added to cart!", "success");
          if (data.cart_count !== undefined) {
            updateCartCount(data.cart_count);
          }
        } else {
          showToast(data.message || "Error adding to cart", "error");
        }
      })
      .catch((error) => {
        console.error("Error:", error);
        showToast("Error adding to cart", "error");
      });
  }

  function confirmDeleteAddress(addressId) {
    if (confirm("Are you sure you want to delete this address?")) {
      fetch(`/api/addresses/${addressId}`, {
        method: "DELETE",
        headers: {
          "Content-Type": "application/json",
          "X-Requested-With": "XMLHttpRequest",
        },
      })
        .then((response) => response.json())
        .then((data) => {
          if (data.success) {
            showToast("Address deleted successfully", "success");
            setTimeout(() => location.reload(), 1000);
          } else {
            showToast(data.message || "Error deleting address", "error");
          }
        })
        .catch((error) => {
          console.error("Error:", error);
          showToast("Error deleting address", "error");
        });
    }
  }

  function editAddress(addressId) {
    // Fetch address data and populate the edit modal
    fetch(`/api/addresses/${addressId}`)
      .then((response) => response.json())
      .then((data) => {
        if (data.success) {
          const address = data.address;
          document.getElementById("edit_address_id").value = address.id;
          document.getElementById("edit_label").value = address.label;
          document.getElementById("edit_full_name").value = address.full_name;
          document.getElementById("edit_phone").value = address.phone;
          document.getElementById("edit_address_line1").value =
            address.address_line1;
          document.getElementById("edit_address_line2").value =
            address.address_line2 || "";
          document.getElementById("edit_city").value = address.city;
          document.getElementById("edit_state").value = address.state;
          document.getElementById("edit_pincode").value = address.pincode;
          document.getElementById("edit_is_default").checked =
            address.is_default;

          // Show modal
          const editModal = new bootstrap.Modal(
            document.getElementById("editAddressModal")
          );
          editModal.show();
        } else {
          showToast("Error loading address data", "error");
        }
      })
      .catch((error) => {
        console.error("Error:", error);
        showToast("Error loading address data", "error");
      });
  }

  function updateCartCount(count) {
    const cartCountElements = document.querySelectorAll(
      ".cart-count, .cart-badge"
    );
    cartCountElements.forEach((element) => {
      element.textContent = count;
    });
  }

  function showToast(message, type = "info") {
    // Create toast container if it doesn't exist
    let toastContainer = document.getElementById("toast-container");
    if (!toastContainer) {
      toastContainer = document.createElement("div");
      toastContainer.id = "toast-container";
      toastContainer.className =
        "toast-container position-fixed top-0 end-0 p-3";
      document.body.appendChild(toastContainer);
    }

    // Create toast element
    const toastEl = document.createElement("div");
    toastEl.className = `toast align-items-center text-bg-${
      type === "success" ? "success" : type === "error" ? "danger" : "info"
    } border-0`;
    toastEl.setAttribute("role", "alert");
    toastEl.setAttribute("aria-live", "assertive");
    toastEl.setAttribute("aria-atomic", "true");

    toastEl.innerHTML = `
        <div class="d-flex">
            <div class="toast-body">
                <i class="fas fa-${
                  type === "success"
                    ? "check-circle"
                    : type === "error"
                    ? "exclamation-circle"
                    : "info-circle"
                } me-2"></i>
                ${message}
            </div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
        </div>
    `;

    toastContainer.appendChild(toastEl);
    const toast = new bootstrap.Toast(toastEl);
    toast.show();

    // Remove toast after it's hidden
    toastEl.addEventListener("hidden.bs.toast", () => {
      toastEl.remove();
    });
  }

  // Initialize progress circles
  document.addEventListener("DOMContentLoaded", function () {
    const progressCircles = document.querySelectorAll(".progress-circle");
    progressCircles.forEach((circle) => {
      const percentage = circle.getAttribute("data-percentage");
      circle.style.setProperty("--percentage", `${percentage}%`);
    });

    // Initialize tooltips
    const tooltipTriggerList = [].slice.call(
      document.querySelectorAll('[data-bs-toggle="tooltip"]')
    );
    const tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
      return new bootstrap.Tooltip(tooltipTriggerEl);
    });

    // Handle form submissions
    const editAddressForm = document.getElementById("editAddressForm");
    if (editAddressForm) {
      editAddressForm.addEventListener("submit", function (e) {
        e.preventDefault();
        const formData = new FormData(this);
        const addressId = document.getElementById("edit_address_id").value;

        fetch(`/api/addresses/${addressId}`, {
          method: "PUT",
          body: formData,
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.success) {
              showToast("Address updated successfully", "success");
              const modal = bootstrap.Modal.getInstance(
                document.getElementById("editAddressModal")
              );
              modal.hide();
              setTimeout(() => location.reload(), 1000);
            } else {
              showToast(data.message || "Error updating address", "error");
            }
          })
          .catch((error) => {
            console.error("Error:", error);
            showToast("Error updating address", "error");
          });
      });
    }
  });
</script>
{% endblock %}
